#==============================================================================
# Print Start G-code (tolerant hotend wait)
# Usage: PRINT_START BED=60 HOTEND=250 [TOL_BELOW=10] [TOL_ABOVE=5]
#==============================================================================
[gcode_macro PRINT_START]
description: Start with hotend tolerance band so we begin when "close enough"
gcode:
    {% set bedtemp     = params.BED|int %}
    {% set hotendtemp  = params.HOTEND|int %}
    {% set tol_below   = (params.TOL_BELOW|default(10))|int %}  # how far below target is OK
    {% set tol_above   = (params.TOL_ABOVE|default(5))|int  %}  # how far above target is OK
    {% set min_ok      = hotendtemp - tol_below %}
    {% set max_ok      = hotendtemp + tol_above %}
    {% if min_ok < 0 %}{% set min_ok = 0 %}{% endif %}

    _SET_FLAP_ENABLED ENABLED=1
    lights_max
    M220 S100                      ; reset speed multiplier
    G90                            ; absolute positioning

    ; Start preheating
    M104 S155                      ; warm extruder to reduce ooze during bed heat
    M190 S{bedtemp}                ; set & wait for bed temp

    ; Home and move clear
    G28
    _CLIENT_LINEAR_MOVE Z=5 F=1500

    ; Re-affirm bed temp before print (optional)
    M190 S{bedtemp}

    ; Set hotend target, then wait within a tolerance band
    SET_HEATER_TEMPERATURE HEATER=extruder TARGET={hotendtemp}
    TEMPERATURE_WAIT SENSOR=extruder MINIMUM={min_ok} MAXIMUM={max_ok}

    ; From here on we’re “close enough” to target; start your routines
    ; NOZZLE_WIPE_LOCATION_READY
    ; NOZZLE_WIPE
    PRIME_LINE
